<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<TITLE>Последовательный интерфейс RS-232 (другие наименования: AUX-асинхронный адаптер, COM-порт, «Стык-2», интерфейс «С-2» и пр</TITLE>
<style type="text/css">
   BODY {font-family:Arial; font-size:10pt; margin-left:10;margin-right:10} 
   TD {font-family:Arial; font-size:10pt}
   P {font-family:Arial; font-size:10pt; text-align:justify}
   LI {font-family:Arial; font-size:10pt}
   UL {font-family:Arial; font-size:10pt}   
   PRE {font-family:Tahoma; font-size:10pt}
   STRONG  {font-family:Arial; font-size:10pt}
   CENTER {font-family:Arial; font-size:10pt}
</style>	
</head>

<body>
<table align="center" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr>
    <td width="15%" height="25" bgcolor="teal"></td>
    <td width="70%" height="25" bgcolor="teal"></td>
    <td width="15%" height="25" bgcolor="teal"></td>
</tr>
<tr>
    <td width="15%" height="50"></td>
    <td width="70%" height="50" align="center"><b><font face="arial black" size="+4" color="Teal">DRMADСКОЕ БАРАХЛО</font></b></td>
    <td width="15%" height="50"></td>
</tr>
<tr>
    <td width="15%" height="25" bgcolor="teal"></td>
    <td width="70%" height="25" bgcolor="teal"></td>
    <td width="15%" height="25" bgcolor="teal"></td>
</tr>
<tr>
    <td width="15%" height="25" bgcolor="#60C0C0"></td>
    <td width="70%" height="25" bgcolor="#60C0C0"></td>
    <td width="15%" height="25" bgcolor="#60C0C0"></td>
</tr>
<tr>
    <td width="15%" height="100%" bgcolor="#60C0C0"></td>
    <td width="70%" height="100%">
	
    <table border="0" bordercolor="teal" width="100%" height="100%" cellpadding="10">
    <tr>
    <td>
	
    <!---> 	

<table width="80%" align="center"><tr><td>

<TABLE ALIGN=CENTER CELLPADDING=0 BGCOLOR="Teal" WIDTH="100%">
<TR>
<TH>
<B>
<P>
<CENTER>
<FONT FACE="Arial" color="white" size="4">
Климентьев К.Е.<BR>
Использование RS-232 для передачи данных
</FONT>
</CENTER>
</P>
</B>
</TH>
</TR>
</TABLE>


<B><P><CENTER>1. Общая характеристика</CENTER></P>
</B><P>Международный<I> стандарт RS-232</I> определяет правила последовательной передачи цифровых данных между двумя устройствами со скоростями от 110 бит/c до 115 Кбит/c (см. табл. 1) на расстояния до 15 м. </P>
<P>Примечание. Применяется большое количество названий для устройств, поддерживающих в той или иной степени стандарт RS-232: асинхронный адаптер (AUX), COM-порт ПЭВМ, устройство “СТЫК-2”, интерфейс “С-2” и пр.</P>
<P>Примечание. Микросхемы интерфейса RS-232 также поддерживают скорости передачи, отличные от стандартных. Например, задав коэффициент деления (код скорости) 10h=16, можно получить скорость V=115200/16=7200 бит/c.</P>
<P>Примечание. При скоростях, отличных от максимальной, возможна надежная передача данных на несколько сотен метров.</P>
<P ALIGN="RIGHT">Таблица 1</P>
Кодирование скорости передачи данных
<P><CENTER><TABLE BORDER CELLSPACING=1 BORDERCOLOR="#000000" CELLPADDING=9 WIDTH=803>
<TR><TD WIDTH="25%" VALIGN="TOP">
<P>Код скорости</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P>Скорость, бит/c</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P>Код скорости</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P>Скорость, бит/c</TD>
</TR>
<TR><TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">600</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">110</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">18</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">4800</TD>
</TR>
<TR><TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">300</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">150</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">С</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">9600</TD>
</TR>
<TR><TD WIDTH="25%" VALIGN="TOP" HEIGHT=5>
<P ALIGN="RIGHT">180</TD>
<TD WIDTH="25%" VALIGN="TOP" HEIGHT=5>
<P ALIGN="RIGHT">300</TD>
<TD WIDTH="25%" VALIGN="TOP" HEIGHT=5>
<P ALIGN="RIGHT">6</TD>
<TD WIDTH="25%" VALIGN="TOP" HEIGHT=5>
<P ALIGN="RIGHT">19200</TD>
</TR>
<TR><TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">С0</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">600</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">3</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">38400</TD>
</TR>
<TR><TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">60</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">1200</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">2</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">57600</TD>
</TR>
<TR><TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">30</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">2400</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">1</TD>
<TD WIDTH="25%" VALIGN="TOP">
<P ALIGN="RIGHT">115200</TD>
</TR>
</TABLE>
</CENTER></P>

<P>В настоящее время RS-232 широко применяется для организации сети между двумя ПЭВМ (в терминах MS Windows это называется “режим прямого кабельного соединения”), для подключения к ПЭВМ устройств типа “мышь”, модемов и т.п., для управления комплексами медицинского и контрольно-кассового оборудования, и пр. Хотя официальный стандарт предусматривает связь двух устройств через RS-232 по 25 линиям (разъем DB25), но в реальных устройствах обычно реализуются “усеченные” варианты интерфейсных устройств, использующие только 9 линий (разъем DB9). Более того, на практике для обмена чаще всего из этих 9 линий используются только 3: TxD (передача данных), RxD (прием данных), SG (сигнальная земля).</P>
<P><CENTER><IMG SRC="Image38.gif" WIDTH=485 HEIGHT=336></CENTER></P>
<P><CENTER>Рис. 1. Нумерация контактов на разъемах различных типов</CENTER></P>
<P>Различают два класса устройств, обменивающихся данными через RS-232, – источники/передатчики данных (DCE) и приемники данных (DTE). Например, модемы являются устройствами типа DCE, компьютеры – DTE, а связь между ними производится по кабелю, который связывает одноименные контакты разъемов между собой (см. рис. 2). Режим связи между двумя устройствами DTE (например, двух компьютеров) называется “режимом нуль - модема” и требует кабелей с перекрестным соединением линий передачи данных (см. рис. 2). Для отладки программ, работающих с RS-232, часто применяют “заглушки” (loopback). </P>
<P><CENTER><IMG SRC="Image39.gif" WIDTH=441 HEIGHT=281></CENTER></P>
<P><CENTER>Рис. 2. Варианты кабелей и заглушек</CENTER></P>
<P>Информационные биты передаются последовательно в соответствии с форматом, изображенным на рисунке 3. Нулевым битам соответствует напряжение в интервале (+3)<FONT FACE="Symbol">ё</FONT> (+12) В, единичным – напряжение в интервале (–12)</FONT><FONT FACE="Symbol">ё</FONT> (-3)В.</P>
</FONT><P>Примечание. Существует технология под названием “токовая петля”, позволяющая передавать данные на большие расстояния в виде токовых сигналов. Для преобразования токовых сигналов в сигналы напряжения диапазона </FONT><FONT FACE="Symbol" SIZE=2>±</FONT> 12В и обратно используются специальные согласующие адаптеры.</P>
</FONT><P><CENTER><IMG SRC="Image40.gif" WIDTH=422 HEIGHT=98></CENTER></P>
<P><CENTER>Рис. 3. Формат кадра передачи данных</CENTER></P>
<P>На этом рисунке START - бит, отмечающий начало “кадра”; DATA - от 5 до 8 информационных битов; PARITY - “бит четности”, служит для проверки целостности передаваемой информации (может отсутствовать); STOP - 1 или 2 бита, отмечающих конец “кадра”. Устройства, связанные по RS-232, должны быть согласованы по скорости передачи и формату кадра. </P>
<P>В ПЭВМ обычно присутствуют два устройства, поддерживающие “усеченный” (9 линий) вариант интерфейса RS-232, и носящие название COM-портов: COM1 (или AUX) и COM2. </P>
</FONT><P>Примечание. По умолчанию ROM BIOS поддерживает также подключение дополнительных портов COM3 и COM4.</P>
</FONT><B><P><CENTER>2. Программирование COM-портов</CENTER></P>
</B><P>Краткие описания регистров, через которые осуществляется взаимодействие ПЭВМ с контроллером COM-портов, приведены в таблице 2.</P>
<P ALIGN="RIGHT">Таблица 2.</P>
<P><CENTER>Некоторые регистры COM-портов</CENTER></P></FONT>
<P><CENTER><TABLE BORDER CELLSPACING=1 BORDERCOLOR="#000000" CELLPADDING=9 WIDTH=812>
<TR><TD WIDTH="10%" VALIGN="TOP">
<P>COM1</TD>
<TD WIDTH="10%" VALIGN="TOP">
<P>COM2</TD>
<TD WIDTH="80%" VALIGN="TOP">
<P>Назначение</TD>
</TR>
<TR><TD WIDTH="10%" VALIGN="TOP">
<P>3F8h</TD>
<TD WIDTH="10%" VALIGN="TOP">
<P>2F8h</TD>
<TD WIDTH="80%" VALIGN="TOP">
<P>Если бит 7 в 3FBh/2FBh равен 1, </P>
<P>То это – младший байт кода скорости</FONT>; </P>
</FONT><P>Иначе это – регистр данных.</TD>
</TR>
<TR><TD WIDTH="10%" VALIGN="TOP">
<P>3F9h</TD>
<TD WIDTH="10%" VALIGN="TOP">
<P>2F9h</TD>
<TD WIDTH="80%" VALIGN="TOP">
<P>Если бит 7 в 3FBh/2FBh равен 1, </P>
<P>То это – младший байт кода скорости; </P>
<P>Иначе – регистр управления: </P>

<UL>
<LI>бит 0 – разрешение прерывания (0Сh для COM1 или 0Bh для COM2) по приходу данных; </LI>
<LI>бит 1 – разрешение прерывания по передаче данных. </UL>
</TD>
</TR>
<TR><TD WIDTH="10%" VALIGN="TOP">
<P>3Fah</TD>
<TD WIDTH="10%" VALIGN="TOP">
<P>2Fah</TD>
<TD WIDTH="80%" VALIGN="TOP">
<P>Регистр причины прерывания: </P>

<UL>
<LI>бит 0: 1 – отсутствие прерываний; </LI>
<LI>биты 1-2: 00 – прерывание по ошибке; 01 – прерывание по появлению новых данных; 10 – прерывание при посылке данных. </UL>
</TD>
</TR>
<TR><TD WIDTH="10%" VALIGN="TOP">
<P>3FBh</TD>
<TD WIDTH="10%" VALIGN="TOP">
<P>2FBh</TD>
<TD WIDTH="80%" VALIGN="TOP">
<P>Управляющий регистр формата “кадра”: </P>

<UL>
<LI>биты 0-1 – количество информационных битов в кадре: 00-5; 01-6; 10-7; 11-8. </LI>
<LI>бит 2 – количество стоповых битов: 0-1; 1-2. </LI>
<LI>Биты 3-4 – способ проверки целостности данных: 00 – не используется; 01 – проверка нечетности; 11 – проверка четности;</LI>
<LI>бит 7 – режим работы регистров 3F8h/3F9h (или 2F8h/2F9h): 1 – содержат код скорости; 0 – иначе. </UL>
</TD>
</TR>
<TR><TD WIDTH="10%" VALIGN="TOP">
<P>3FDh</TD>
<TD WIDTH="10%" VALIGN="TOP">
<P>2FDh</TD>
<TD WIDTH="80%" VALIGN="TOP">
<P>Управляющий регистр состояния: </P>

<UL>
<LI>бит 0 – готовность данных для чтения; </LI>
<LI>бит 1 – ошибка переполнения; </LI>
<LI>бит 2 – ошибка четности;</FONT> </LI>
</FONT>
<LI>бит 3 – ошибка синхронизации; </LI>
<LI>бит 4 – запрос на обрыв передачи (последовательность нулей); </LI>
<LI>бит 5 – готовность передатчика для записи; </LI>
<LI>бит 6 – регистр сдвига пуст; </LI>
<LI>бит 7 - устройство отключено.</UL>
</TD>
</TR>
</TABLE>
</CENTER></P>

<P>Для управления потоками данных могут использоваться различные варианты протоколов обмена. <I>Аппаратные протоколы</I> требуют использования специальных линий синхронизации и, соответственно, “полных” вариантов соединительных кабелей. Среди <I>программных протоколов</I> самым простым является “XON/XOFF”: если приемник не готов к приему, то он посылает по своей линии TxD код XOFF=13h, а передатчик, приняв этот код, должен приостановить передачу до тех пор, пока не получит код XON=11h.</P>
<B><P><CENTER>2.1. Непосредственная инициализация COM-порта</CENTER></P>
</B><P>После включения ПЭВМ COM1 по умолчанию инициализируется в следующее состояние: прерывания отключены, буферизация не используется, 8 бит данных, бит четности не используется, скорость передачи 2400 бит/c. Изменить эти установки можно следующим образом.</P>
<I><P>Шаг 1 – сброс COM-порта в исходное состояние</I>. Это действие не является обязательным и рекомендуется только в тех случаях, если COM-порт ранее был уже проинициализирован какой-нибудь другой программой (например, драйвером мыши). Необходимо записать 0 в регистры с адресами 2F9h/3F9h и 2FAh/3FAh (запретив тем самым прерывания и буферизацию). Затем следует однократно прочитать регистры с адресами 2FAh/3FAh, 2FBh/3FBh и 2FCh/3FCh (эта операция сбросит возможно оставшиеся от предыдущей работы с устройством битовые признаки).</P>
<I><P>Шаг 2 – установка скорости передачи данных</I>. Скорость передачи данных кодируется в соответствии с таблицей 1. Младший байт этого значения помещается по адресу 2F8h/3F8h, старший – по адресу 2F9h/3F9h, причем предварительно необходимо установить особый режим доступа к этим регистрам, записав в порт 2FBh/3FBh значение с единицей в старшем бите (например, 80h).</P>
<I><P>Шаг 3 - установка формата блока данных</I>. Формат блока данных кодируется отдельными битами и группами битов регистра с адресом 2F9h/3F9h (см. табл. 2). </P>
</FONT><P><CENTER><IMG SRC="Image41.gif" WIDTH=652 HEIGHT=376></CENTER></P>
<P><CENTER>Рис 4. ВП инициализации COM-портов</CENTER></P>
<B><P><CENTER>2.2. Обмен данными при помощи опроса битов готовности</CENTER></P>
</B><I><P>Передача данных.</I> Перед записью символа в регистр данных COM-порта, расположенный по адресу 2F8h/3F8h, необходимо убедиться, что он готов для передачи. Признаком готовности является установленный в 1 бит 5 регистра состояния линии с адресом 2FDh/3FDh.</P>
</FONT><P><CENTER><IMG SRC="Image42.gif" WIDTH=690 HEIGHT=311></CENTER></P>
<P><CENTER>Рис. 5. ВП передачи данных</CENTER></P>
<I><P>Прием данных.</I> Перед чтением символа из регистра данных COM-порта, расположенного по адресу 2F8h/3F8h, необходимо убедиться, что этот символ получен и готов для считывания. Признаком готовности является установленный в 1 бит 0 регистра состояния линии с адресом 2FDh/3FDh.</P>
</FONT><P><CENTER><IMG SRC="Image43.gif" WIDTH=686 HEIGHT=300></CENTER></P>
<P><CENTER>Рис. 6. ВП приема данных</CENTER></P>
<P>Пример совместного применения этих ВП приведен на рис. 7.</P>
</FONT><P><CENTER><IMG SRC="Image44.gif" WIDTH=582 HEIGHT=221></CENTER></P>
<P><CENTER>Рис 7. Демонстрация совместной работы ВП COMINIT и COMREAD</CENTER></P>
<B><P><CENTER>2.3. Обмен данными с использованием прерываний</CENTER></P>
</B><P>Для установки режима работы COM-порта с использованием прерываний необходимо в процессе инициализации записать бит разрешения прерываний в регистр 2F8h/3F8h. Кроме того, необходимо размаскировать требуемые прерывания в регистре маски системного контроллера прерываний с адресом 21h (бит 3 отвечает за IRQ3, а бит 4 – за IRQ4; нулевое значение бита означает разрешение соответствующего прерывания). Также необходимо предусмотреть наличие специальной процедуры обработки возникающих прерываний. Эта процедура должна завершаться посылкой значения 20h в управляющий регистр системного контроллера прерываний с адресом 20h.</P>
<P>Прототип DOS-программы ввода данных из COM2 по прерыванию.</P></FONT>
<TABLE BORDER CELLSPACING=1 CELLPADDING=9 WIDTH=821>
<TR><TD VALIGN="TOP">
<P>(* Здесь описываются переменные *)<br>
</FONT>Var . . .<br>
</FONT>(* Обработчик прерывания *)<br>
</FONT>procedure New0B; interrupt;<br>
begin<br>
</FONT>(* Прием байта *)<br>
</FONT>c[i] := port[$2F8];<br>
inc(i);<br>
</FONT>(* Выход из прерывания *)<br>
</FONT>port[$20]:=$20;<br>
end;<br>
begin<br>
</FONT>(* Инициализация обработчика прерываний *)<br>
</FONT>GetIntVec($0B, Old0B);<br>
SetIntVec($0B, @New0B);<br>
</FONT>(* Инициализация устройства *)<br>
</FONT>port[$2FB] := 3; (* 00000011 – </FONT>формат “кадра” *)<br>
port[$2FB] := $80; (* Переключение режима *)<br>
port[$2F8] := $80; (* Младший байт кода скорости 300 *)<br>
port[$2F9] := 1; (* Старший байт кода скорости 300 *)<br>
port[$2F9] := 1; (* Разрешение прерываний *)<br>
</FONT>i:=0;<br>
while not keypressed do begin<br>
...<br>
</FONT>(* В этом цикле можно выполнять “полезную” работу *)<br>
</FONT>...<br>
end;<br>
</FONT>(* Восстановление старого обработчика прерываний *)<br>
</FONT>SetIntVec($0B, OldOb);<br>
end.<br>
</TD>
</TR>
</TABLE>

<B><P><CENTER>2.4. Обмен данными обращением к драйверу COM-портов</CENTER></P>
</B><P>В соответствии с современными представлениями непосредственное взаимодействие прикладной программы с контроллером внешнего устройства должно быть ограничено. Посредником между ними должен служить специальный компонент операционной системы – драйвер устройства. В стандартных библиотеках LabVIEW присутствует набор виртуальных приборов, предназначенных для работы с коммуникационными портами (см. рис. 8):</P>

<UL>
</FONT><B><LI>Serial Port Init</B></FONT> – инициализировать последовательный порт;</LI>
</FONT><B><LI>Serial Port Write</B></FONT> - передача строки символов в последовательный порт; </LI>
</FONT><LI>S<B>erial Port Read </B></FONT>– чтение строки символов из последовательного порта;</LI>
</FONT><B><LI>Bytes At Serial Port</B></FONT> – определить количество еще непрочитанных байтов в последовательном порту; </LI>
</FONT><B><LI>Serial Port Break</B></FONT> – в течение указанного интервала времени держать на линии данных нулевое значение, что соответствует состоянию “BREAK”.</LI></UL>

</FONT><P><CENTER><IMG SRC="Image45.gif" WIDTH=599 HEIGHT=441></CENTER></P>
<P><CENTER>Рис. 8. Виртуальные приборы для работы с COM-портами ПЭВМ</CENTER></P>
<P>На рис 9. приведен пример использования этих виртуальных приборов для тестирования COM-порта при помощи заглушки. В порт посылается текстовая строка, и она же считывается из него и отображается в виде множества ASCII-кодов отдельных символов.</P>
</FONT><P><CENTER><IMG SRC="Image46.gif"></CENTER></P>
<P><CENTER>Рис 9. Тестирование COM-порта при помощи заглушки</CENTER></P>
</FONT><P>Примечание. Порту COM1 соответствует кодовое значение 0, порту COM2 – значение 1 и т.д. Значения, начиная с 10, зарезервированы для передачи данных через параллельные порты: порту LPT1 соответствует значение 10, порту LPT2 значение 11 и т.д.</P>
</FONT><B><P><CENTER>2.5. Обмен данными средствами VISA</CENTER></P>
</B></FONT><P>VISA (Virt</FONT>ual Instrument Software Architecture) – это объектно-ориентированная библиотека, обеспечивающая единообразный доступ приложений LabVIEW ко внешним устройствам. Фактически, VISA представляет собой набор программных “кубиков”, из которых можно комплектовать</FONT> </FONT>драйверы внешних устройств.</P>
<P>По умолчанию в LabVIEW присутствуют готовые VISA-драйвера для доступа к последовательным портам и к устройствам, снабженным приборным интерфейсом “КОП - канал общего пользования” (GPIB 488.2). Начиная с LabVIEW v6.0 фирма National Instruments рассматривает VISA-драйвера в качестве основного метода работы с последовательными портами (при этом возможности, рассмотренные в п. 2.4. по-прежнему остаются доступными). </P>
<P>Основные виртуальные приборы, используемые для доступа к COM-портам через VISA (см. рис 10.):</P>

<UL>
</FONT><B><LI>VISA Open</B></FONT> – открывает “сеанс VISA”, т.е. устанавливает связь с интерфейсом, заданным именем (вход “resource name”) и классом (вход “VISA session (for class)”), и возвращает уникальный идентификатор (выход “VISA session”), поставленный в соответствие этому интерфейсу;</LI>
</FONT><B><LI>VISA Close</B></FONT> – завершает работу с устройством;</LI>
</FONT><B><LI>VISA Write</B></FONT> – записывает в устройство указанное количество байтов;</LI>
</FONT><B><LI>VISA Read</B></FONT> – читает из устройства требуемое количество байтов.</LI></UL>

</FONT><P><CENTER><IMG SRC="Image47.gif" WIDTH=695 HEIGHT=410></CENTER></P>
<P><CENTER>Рис 10. Некоторые виртуальные приборы, работающие с COM-портами средствами VISA</CENTER></P>
</FONT><P>Примечание. Для работы VISA-драйверов необходимо наличие в составе LabVIEW установленного компонента NI VISA.</P>
</FONT><P>Каждый интерфейс, доступ к которому осуществляется средствами VISA, первоначально идентифицируется параметрами “класс” и “имя”. Источником первого параметра является объект передней панели “Visa session”. Щелкнув по нему правой клавишей мыши, можно получить систему меню, позволяющих определить свойства этого объекта (см. рис. 11). Обычно достаточно указать, к какому классу принадлежит интерфейс, ассоциированный с объектом. Для COM-портов это должен быть наиболее общий класс – “Instr” (но не “Serial Instr”!). </P>
</FONT><P><CENTER><IMG SRC="Image48.gif" WIDTH=501 HEIGHT=503></CENTER></P>
<P><CENTER>Рис. 11. Указание класса, к которому принадлежит интерфейс</CENTER></P>
<P>Имя интерфейса конструируется в соответствии с табл. 3 (поля в квадратных скобках являются необязательными). Например, для COM1 это будет “ASRL1::INSTR”.</P>
<P ALIGN="RIGHT">Таблица 3.</P>
<P><CENTER>Правила конструирования имен</CENTER></P>
<P><CENTER><TABLE BORDER CELLSPACING=1 BORDERCOLOR="#000000" CELLPADDING=9 WIDTH=727>
<TR><TD WIDTH="29%" VALIGN="TOP">
<P>Интерфейс </TD>
<TD WIDTH="71%" VALIGN="TOP">
<P>Шаблон имени</TD>
</TR>
<TR><TD WIDTH="29%" VALIGN="TOP">
<P>GPIB</TD>
<TD WIDTH="71%" VALIGN="TOP">
<P>GPIB[номер]::первый адрес[::второй адрес][::INSTR]</TD>
</TR>
<TR><TD WIDTH="29%" VALIGN="TOP">
<P>GPIB-VXI</TD>
<TD WIDTH="71%" VALIGN="TOP">
<P>GPIB-VXI[номер]::VXI логический адрес[::INSTR]</TD>
</TR>
<TR><TD WIDTH="29%" VALIGN="TOP">
<P>VXI</TD>
<TD WIDTH="71%" VALIGN="TOP">
<P>VXI[номер]::VXI логический адрес[::INSTR]</TD>
</TR>
<TR><TD WIDTH="29%" VALIGN="TOP">
<P>Последовательный</TD>
<TD WIDTH="71%" VALIGN="TOP">
<P>ASRL[номер][::INSTR]</TD>
</TR>
</TABLE>
</CENTER></P>

<P>Для конфигурирования параметров передачи информации используется атрибутный узел “VISA Attribute Node”. Необходимо расширить его при помощи инструмента “стрелочка” до нужного количества атрибутов, затем, нажимая “пальчиком” на отдельные поля, выбрать из меню желаемые атрибуты</FONT> </FONT>(например, “Serial Baud Rate” (“Скорость последовательной передачи в бодах”) ), правой клавишей мыши через всплывающее меню переключить их из состояния “Read” в состояние “Write” и соединить с полями желаемые значения.</P>
</FONT><P>Примечание. В LabVIEW разных версий имена полей атрибутного узла могут несколько различаться. Например, одно и то же поле в LabVIEW v4.0.1 называется “Serial Data Bits”, а в LabVIEW 6.0 “Serial Settings: Serial Data Bits”. Кроме того, возможно переключение режима отображения имен из “полного</FONT>”</FONT> в “сокращенный”, например, в просто “Baud”.</P>
<P>Примечание. В LabVIEW, начиная с версии 6.0, работа с атрибутным узлом оформлена в виде отдельного виртуального прибора “VISA Configure Serial Port”.</P>
</FONT><P>В процессе работы этих виртуальных приборов могут возникнуть ошибки. Для обработки ошибок проще всего использовать виртуальный прибор “General Error Handler” (но не “Simple Error Handler”!). Также в процессе работы этих виртуальных приборов могут возникнуть “особые состояния”, которые формально не являются ошибками</FONT>,</FONT> и поэтому не будут обработаны узлом “General Error Handler”. Для того, чтобы на них правильно отреагировать, можно “расщепить” сложный тип “Error” на составляющие, и в поле “Status” получить номер ошибки или “особого состояния”. Список номеров “особых событий” и комментариев к ним можно найти в файле VISASTAT.INI.</P>
<P>Техника работы с COM-портами средствами VISA иллюстрируется на рис. 12.</P>
</FONT><P><CENTER><IMG SRC="Image49.gif"><br>Рис. 12. Работа с COM-портами через VISA</CENTER></P>

<hr>
<p>
(с) Constantin E. Climentieff aka DrMad,
<a href="mailto:drmad@dr.com"> mailto: drmad@dr.com</a> * 
<a href="http://www.chat.ru/~drmad">http://www.chat.ru/~drmad</a>
</p>

</td></tr></table>


    </td>
    </tr>
    </table>
    </td>

    <td width="15%" height="100%" bgcolor="#60C0C0"></td>
</tr>
</table>

</body>
</html>

